---
import { Icon } from "astro-icon/components";
import { GET as getUser } from "../pages/api/oauth/get-user";

const userId = Astro.cookies.get("userId")?.value ?? "0";
let user = null;

if (userId !== "0") {
  const response = await getUser({
    request: new Request(`http://localhost/api/oauth/get-user?id=${userId}`),
  });
  //@ts-ignore
  user = await response.json();
}
---

<div class="mr-5">
  {
    user ? (
      <div class="flex align-middle items-center">
        <img
          class="w-10 h-10 p-1 rounded-full ring-2 ring-gray-300 dark:ring-gray-500"
          src={`https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`}
          alt="User Avatar"
        />
      </div>
    ) : (
      <div id="login" class="flex align-middle items-center">
        <Icon
          class="text-4xl hover:text-ctp-sky hover:scale-105 transition-all duration-100"
          id="nav-open"
          href={import.meta.env.BACKEND_OAUTH_URI}
          name="mdi:anonymous"
        />
      </div>
    )
  }
</div>

<script>
  import { navigate } from "astro:transitions/client";

  document.getElementById("login")!.addEventListener("click", () => {
    navigate(import.meta.env.BACKEND_OAUTH_URI);
  });
</script>
