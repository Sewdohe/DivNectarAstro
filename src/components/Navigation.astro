---
import path from "path";
import Hamburger from "./Hamburger.astro";
import User from "../components/NavUser.astro";
import { Icon } from "astro-icon/components";
const links = [
  {
    name: "Home",
    url: "/",
    path: "",
    icon: "line-md:home-alt-twotone",
  },
  {
    name: "Blog",
    url: "/blog",
    path: "blog",
    icon: "line-md:text-box-multiple-twotone",
  },
  {
    name: "Discord",
    url: "/discord",
    path: "discord",
    icon: "line-md:discord",
  },
  // {
  //   name: "SkyNectar",
  //   url: "",
  //   path: "",
  //   children: [
  //     { name: "About", url: "/minecraft" },
  //     { name: "Leaderboards", url: "/minecraft/leaderboard" },
  //     { name: "Players", url: "/minecraft/players" },
  //     { name: "Chat", url: "/minecraft/server-events" },
  //     { name: "Server Wiki", url: "https://skyblock-wiki.divnectar.com" },
  //   ],
  // },
  {
    name: "Minecraft",
    url: "/minecraft",
    path: "minecraft",
    icon: "creeper",
  },
  {
    name: "About",
    url: "/about",
    path: "about",
    icon: "line-md:person-twotone",
  },
];

const pathname = new URL(Astro.request.url).pathname;

// Function to check if a link is active
function isLinkActive(linkUrl: string, currentPath: string): boolean {
  if (linkUrl === '/') {
    return currentPath === '/';
  }
  return currentPath.startsWith(linkUrl);
}
---

<!-- This div is the medium-and up normal navbar.
it's hidden on small devices and replaced with a bottom-style navbar on mobile. -->
<div
  class="hidden md:flex fixed top-0 p4 z-50 w-screen max-w-screen h-16 bg-ctp-crust items-center"
>
  <a
    class="mocha hover:scale-105 hover:text-ctp-peach transition-all duration-100 flex-grow md:flex-grow-0 px-4 justify-start text-ctp-text prose-2xl font-bold"
    href="/">DivNectar</a
  >
  <div
    class="hidden md:flex md:flex-grow justify-center items-center text-ctp-text"
  >
    {
      links.map((link) => (
        <div class="relative group px-4">
          <a
            class={`
              ${isLinkActive(link.url, pathname) ? "active" : ""}
              text-ctp-text no-underline relative
              lg:text-lg hover:text-ctp-teal transition-all duration-300 cursor-pointer
            `}
            href={link.url}
          >
            {link.name}
          </a>
        </div>
      ))
    }
  </div>
  <Hamburger navLinks={links} />
  <User class="justify-self-end z-20 items-end" />
</div>
<!-- This is the mobile bottom navigation bar. -->
<div
  class="flex flex-row z-50 w-screen md:hidden bg-ctp-surface0 border-t-2 border-t-ctp-teal
        fixed bottom-0 left-0 right-0 items-center h-16 rounded-md shadow-lg"
>
  {
    links.map((link) => (
      <a
        class={`flex justify-evenly self-center items-center w-full cursor-pointer transition-all duration-300
                ${isLinkActive(link.url, pathname) ? 'mobile-active' : 'hover:scale-105'}
        `}
        href={link.url}
      >
        <Icon
          class={`text-4xl transition-all duration-300
                  ${isLinkActive(link.url, pathname) ? 'text-ctp-pink scale-110' : 'text-ctp-text hover:text-ctp-sky'}
          `}
          name={link.icon}
        />
      </a>
    ))
  }
</div>

<!-- this div just matches the height of the navbar
to keep the content from going below it on page load. -->
<!-- throw extra margin on the bottom to make content look nice -->
<!-- <div class="h-16"></div> -->

<style>
  /* Desktop active link with animated underline */
  .active {
    color: var(--ctp-sky);
  }

  .active::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, var(--ctp-pink), var(--ctp-mauve));
    border-radius: 2px;
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      width: 0%;
      opacity: 0;
    }
    to {
      width: 100%;
      opacity: 1;
    }
  }

  /* Mobile active indicator */
  .mobile-active {
    position: relative;
  }

  .mobile-active::before {
    content: '';
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    background: var(--ctp-pink);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }
    50% {
      opacity: 0.7;
      transform: translateX(-50%) scale(1.2);
    }
  }
</style>
